<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://checkout.culqi.com/js/v4"></script>
</head>

<body>

<script type="text/javascript">
    var json =  JSON.parse(Android.sendParamsCheckoutv4FromAndroid());

	Culqi.publicKey = 'pk_test_90667d0a57d45c48';


    Culqi.settings({
      title: json.title,
      currency: 'PEN',
      amount: json.amount,
      version: '3',
	  order: json.orderId,
    });
    Culqi.options({
      lang: 'es',
	  installments: true,
      paymentMethods: {
        tarjeta: true,
		yape: true,
        bancaMovil: true,
        agente: true,
        billetera: true,
        cuotealo: true,
      },
      style: {
        bannerColor: '', // hexadecimal
        buttonBackground: '', // hexadecimal
        menuColor: '', // hexadecimal
        linksColor: '', // hexadecimal
        buttonText: "Donar",

        priceColor: '',
        //logo: 'https://avatars.githubusercontent.com/u/13783771?s=280&v=4'
      }
    });

    function culqi() {
      console.log("todo el objeto da " + Culqi.order);
      if (Culqi.token) {
        let token = Culqi.token.id;
        const message = `Se ha creado el objeto Token: ${token}. Recordar que hasta este punto solo se ha generado un token, no se ha realizado un cargo a ninguna tarjeta.`;
        console.log('Jordan');
        console.log('message ~> ', message);
        var jsonData = {
          "amount": "10000",
          "currency_code": "PEN",
          "email": "jordan.diaz3@culqi.com",
          "source_id": token,
          "capture": false
        };
        // alert(message);
         // Realizar la llamada al servicio por POST
         // Se recomienda no poner la llave sk directamente en el codigo fuente aqui se puso por temas de pruebas
          fetch('https://api.culqi.com/v2/charges', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': 'Bearer sk_test_1573b0e8079863ff'
            },
            body: JSON.stringify(jsonData)
          })
          .then(response => {
              if (response.ok) {
                console.log("Llamado Exitoso");
                window.AndroidInterfaceMessage.onCulqiMenssage();
                return response.json(); // Devuelve la promesa con los datos de la respuesta
              } else {
                console.log("Llamado con error");
                window.AndroidInterfaceMessageError.onCulqiMenssageError();
                throw new Error('Error en la llamada al servicio por POST: ' + response.status + ' ' + response.statusText);
              }
          })
          .then(data => {
              // Aquí puedes acceder a los datos de la respuesta
              console.log('Respuesta del endpoint:', data);
            })
          .catch(error => {
            console.log('Error en la llamada al servicio por POST' + error);
            // Aquí puedes manejar el error en la llamada al servicio
          });
        //history.back();
        Culqi.close();
        window.AndroidInterface.onCulqiClose();
      } else if (Culqi.order) {
        let order = Culqi.order;

        if (Culqi.order.cuotealo != null) {

        }

        const message = `Se ha creado el objeto Order: ${order}. Recordar que hasta este`;
        console.log('message ~> ', message);
        // alert(message);
        // Culqi.close();
      } else {
        console.log(Culqi.error.user_message);
      }
    };

    closeCheckout = function () {
      console.log('se cerró el checkout... ');
      window.AndroidInterface.onCulqiClose();
    }

    Culqi.open();
  </script>
</body>
</html>